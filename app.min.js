var express=require("express"),app=express(),request=require("request"),bodyParser=require("body-parser"),mongoose=require("mongoose"),flash=require("connect-flash"),contactRoutes=require("./routes/contact"),passport=require("passport"),LocalStrategy=require("passport-local"),methodOverride=require("method-override"),Movie=require("./models/movie"),Comment=require("./models/comment"),User=require("./models/user"),seedDB=require("./seeds"),commentRoutes=require("./routes/comments"),movieRoutes=require("./routes/movies"),indexRoutes=require("./routes/index");app.locals.moment=require("moment"),app.use(require("express-session")({secret:"This is the secret",resave:!1,saveUninitialized:!1})),app.use(passport.initialize()),app.use(passport.session()),passport.use(new LocalStrategy(User.authenticate())),passport.serializeUser(User.serializeUser()),passport.deserializeUser(User.deserializeUser());var url=process.env.DBURL||"mongodb://localhost/movieDB";mongoose.connect(url),app.set("view engine","ejs"),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.static(__dirname+"/public")),app.use(methodOverride("_method")),app.use(flash()),app.use(function(e,s,r){s.locals.currentUser=e.user,s.locals.error=e.flash("error"),s.locals.success=e.flash("success"),s.locals.warning=e.flash("warning"),r()}),app.use("/contact",contactRoutes),app.use(indexRoutes),app.use("/movies",movieRoutes),app.use("/movies/:id/comments",commentRoutes),app.listen(process.env.PORT||3e3,process.env.IP,function(){console.log("Movie Review server has started.")});