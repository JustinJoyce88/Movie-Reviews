var express=require("express"),router=express.Router(),nodemailer=require("nodemailer"),request=require("request");router.get("/",function(e,r){r.render("contact/contactMe",{page:"contact"})}),router.post("/send",function(e,r){var o=e.body["g-recaptcha-response"];if(!o)return console.log(e.body),e.flash("error","Please select captcha"),r.redirect("back");var s,a=`https://www.google.com/recaptcha/api/siteverify?secret=${process.env.CAPTCHA}&response=${o}&remoteip=${e.connection.remoteAddress}`;request.get(a,(o,s,a)=>{if(void 0!==a.success&&!a.success)return e.flash("error","Captcha Failed"),r.redirect("/contact");var t=nodemailer.createTransport({service:"Gmail",auth:{user:"justins.web.dev@gmail.com",pass:process.env.GMAILPW1}}),n={from:"Justin Joyce <justins.web.dev@gmail.com",to:"justins.web.dev@gmail.com",replyTo:e.body.email,subject:"Movie contact request from: "+e.body.name,text:"You have received an email from... Name: "+e.body.name+" Phone: "+e.body.phone+" Email: "+e.body.email+" Message: "+e.body.message,html:"<h3>You have received an email from...</h3><ul><li>Name: "+e.body.name+" </li><li>Phone: "+e.body.phone+" </li><li>Email: "+e.body.email+" </li></ul><p>Message: <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+e.body.message+" </p>"};t.sendMail(n,function(o,s){o?(console.log(o),e.flash("error","Something went wrong... Please try again later!"),r.redirect("/contact")):(e.flash("success","Your email has been sent, we will respond within 24 hours."),r.redirect("/movies"))})})}),module.exports=router;